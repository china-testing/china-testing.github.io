<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>python库介绍-图像处理工具pillow中文文档-手册(2018 5.*)</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">python自动化测试人工智能 </a></h1>
                <nav><ul>
                    <li><a href="/category/ce-shi.html">测试</a></li>
                    <li><a href="/category/ce-shi-kuang-jia.html">测试框架</a></li>
                    <li><a href="/category/common.html">common</a></li>
                    <li><a href="/category/feng-shui.html">风水</a></li>
                    <li><a href="/category/ji-qi-xue-xi.html">机器学习</a></li>
                    <li><a href="/category/jie-meng.html">解梦</a></li>
                    <li><a href="/category/linux.html">linux</a></li>
                    <li class="active"><a href="/category/python.html">python</a></li>
                    <li><a href="/category/shu-ji.html">书籍</a></li>
                    <li><a href="/category/shu-ju-fen-xi.html">数据分析</a></li>
                    <li><a href="/category/zhong-cao-yao.html">中草药</a></li>
                    <li><a href="/category/zhong-yi.html">中医</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/python3_lib_pil.html" rel="bookmark"
           title="Permalink to python库介绍-图像处理工具pillow中文文档-手册(2018 5.*)">python库介绍-图像处理工具pillow中文文档-手册(2018 5.*)</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-12-03T19:20:00+08:00">
                Published: 一 03 十二月 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew.html">andrew</a>
        </address>
<p>In <a href="/category/python.html">python</a>.</p>

</footer><!-- /.post-info -->      <ul>
<li><a href="https://china-testing.github.io/practices.html">python测试开发项目实战-目录</a></li>
<li><a href="https://china-testing.github.io/python_books.html">python工具书籍下载-持续更新</a></li>
<li><a href="https://china-testing.github.io/python3_quick.html">python 3.7极速入门教程 - 目录</a></li>
</ul>
<h2 id="_1">概述</h2>
<p>Python Imaging Library给Python解释器增加了图像处理能力。</p>
<p>该库提供了广泛的文件格式支持，高效的内部展现，以及十分强大的图像处理能力。</p>
<p>核心图像库专为以几种存储为基本像素格式数据的快速访问而设计。它为通用图像处理工具提供了坚实的基础。</p>
<p>我们来看看这个库的用途。</p>
<ul>
<li>图像存储</li>
</ul>
<p>PIL适合图像归档和图像批量处理，你可以使用它建立缩略图，转换格式，打印图片等。</p>
<p>现在的版本可以识别和读取大量的图片格式，写入常用的转换和表示格式。</p>
<ul>
<li>图像显示</li>
</ul>
<p>当前版本包含了Tk <a href="https://pillow.readthedocs.io/en/latest/reference/ImageTk.html#PIL.ImageTk.PhotoImage">PhotoImage</a>和<a href="https://pillow.readthedocs.io/en/latest/reference/ImageTk.html#PIL.ImageTk.BitmapImage">BitmapImage</a>接口, 以及<a href="https://pillow.readthedocs.io/en/latest/reference/ImageTk.html#PIL.ImageTk.BitmapImage">Windows DIB interface</a> ，可以在PythonWin和其他基于Windows的工具包中使用。许多其他GUI工具包带有某种类型的PIL支持。</p>
<p>为了方便调试还提供了show()方法，可以保存图像到磁盘并调用外显示。它将图像保存到磁盘，并调用外部显示工具。</p>
<ul>
<li>图像处理</li>
</ul>
<p>这个库包含了基本的图像处理功能，包括点操作，使用内置卷积内核过滤，色彩空间转换。</p>
<p>这个库还支持更改图像大小、旋转、任意仿射变换。</p>
<p>直方图方法允许你统计图像，这可以用于对比度增强和全局统计分析。</p>
<h2 id="_2">教程</h2>
<h3 id="image">使用 Image 类</h3>
<p>PIL最重要的类是<a href="https://github.com/python-pillow/Pillow/blob/master/docs/handbook/tutorial.rst">Image</a>, 你可以通过多种方法创建这个类的实例，比如从文件加载图像，或者处理其他图像, 或者从或从头开始创建图像。</p>
<p>要从文件加载图像，请使用：<a href="https://pillow.readthedocs.io/en/latest/reference/Image.html#module-PIL.Image">Image</a>模块中的<a href="https://pillow.readthedocs.io/en/latest/reference/Image.html#PIL.Image.open">open</a>函数：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;hopper.ppm&quot;</span><span class="p">)</span>
</pre></div>


<p>如果成功，这个函数返回<a href="https://pillow.readthedocs.io/en/latest/reference/Image.html#PIL.Image.Image">Image</a>对象。 您现在可以使用实例属性来检查文件内容：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
<span class="n">PPM</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span> <span class="n">RGB</span>
</pre></div>


<p>format属为图像来源。如果不是从文件读取就是None。size属性是包含宽度和高度(像素)的二元组）。模式属性定义了图像中波段的数量和名称，以及像素类型和深度。 常见模式为灰度图像为“L”（亮度），真彩色图像为“RGB”，印刷四色为“CMYK”。</p>
<p>如果文件无法打开，则会引发IOError异常。</p>
<p>获得了Image类的实例，就可以使用此类定义的方法来处理和操作图像。 例如让我们显示刚刚加载的图像：</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">im</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p>注意</p>
<p><a href="https://pillow.readthedocs.io/en/latest/reference/Image.html#PIL.Image.Image.show">show</a>的标准版本效率不高，因为它将图像保存到临时文件并调用xv工具显示图像。 如果你没有安装xv，它甚至不会工作。 它对于调试和测试非常方便。</p>
<p>下面实例把上述步骤给串起来</p>
<p>pillow_read.py</p>
<div class="highlight"><pre><span></span><span class="c1"># 项目实战讨论QQ群630011153 144081101</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;demo.jpg&quot;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><a href="https://github.com/china-testing/python-api-tesing/tree/master/python3_libraries/pillow">代码地址</a></p>
<p>以下各节概述了此库中提供的不同功能。</p>
<p><img alt="image.png" src="https://upload-images.jianshu.io/upload_images/10819934-26039cda34c4553b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<h2 id="_3">参考资料</h2>
<ul>
<li><a href="https://github.com/china-testing/python-api-tesing/blob/master/books.md">本文相关书籍下载</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing">本文涉及的python测试开发库</a> 谢谢点赞！</li>
<li><a href="https://pillow.readthedocs.io/en/latest/handbook/tutorial.html">英文参考</a></li>
<li><a href="https://china-testing.github.io/python3_lib_pil.html">本文最新版本</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing/blob/master/python3_libraries/pillow/">代码地址</a></li>
</ul>
<h3 id="_4">读写图像</h3>
<p>PIL库支持大量图片格式。使用Image模块的open()函数从磁盘读取文件。你不需要知道文件格式就能打开它，PIL能够根据文件内容自动确定确定文件格式。</p>
<p>要保存文件，使用Image类的save()方法。保存文件的时候文件名变得重要了。除非你指定格式，PIL将会以文件名的扩展名作为格式保存。</p>
<p>转换文件为JPEG</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">f</span> <span class="o">+</span> <span class="s2">&quot;.jpg&quot;</span>
    <span class="k">if</span> <span class="n">infile</span> <span class="o">!=</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cannot convert&quot;</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
</pre></div>


<p>save()方法的第二个参数可以指定文件格式，如果你使用非标准的扩展名你必须这样做。</p>
<p>创建 JPEG 缩略图</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>

<span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">infile</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.thumbnail&quot;</span>
    <span class="k">if</span> <span class="n">infile</span> <span class="o">!=</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">thumbnail</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">im</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;JPEG&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cannot create thumbnail for&quot;</span><span class="p">,</span> <span class="n">infile</span><span class="p">)</span>
</pre></div>


<p>需要注意的是，除非真的需要，否则库不会解码或加载栅格数据。打开文件时，会读取文件头以确定文件格式并提取解码文件所需的模式，大小和其他属性，但文件的其余部分在稍后才能处理。</p>
<p>这意味着打开图像文件是快速操作，和文件大小和压缩类型无关。比如快速识别图像文件：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">for</span> <span class="n">infile</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span> <span class="k">as</span> <span class="n">im</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">x</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>


<h3 id="_5">剪切，粘贴，合并图像</h3>
<p>Image类包含允许您操作图像内区域的方法。要从图像中提取子矩形，请使用crop()方法。</p>
<p>复制图像中的子矩形</p>
<div class="highlight"><pre><span></span><span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
</pre></div>


<p>该区域由四元组定义，其中坐标是（左，上，右，下）。 PIL使用左上角为 (0, 0) 的坐标系。另请注意，坐标是指像素之间的位置，因此上例中的区域恰好为300x300像素。</p>
<p>现在可以以某种方式处理该区域并粘贴回来。</p>
<p>处理子矩形并粘贴回来</p>
<div class="highlight"><pre><span></span><span class="n">region</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">ROTATE_180</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">box</span><span class="p">)</span>
</pre></div>


<p>当粘贴区域时，区域的大小必须完全匹配。但是模式不需要匹配。模式不匹配时会在粘贴之前自动转换。</p>
<p>滚动图像</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Roll an image sideways.&quot;&quot;&quot;</span>
    <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">%</span> <span class="n">xsize</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">image</span>

    <span class="n">part1</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">part1</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">part2</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">part2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">part1</span><span class="p">,</span> <span class="p">(</span><span class="n">xsize</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">image</span>
</pre></div>


<p>调用示例：</p>
<p>pillow_roll.py</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Roll an image sideways.&quot;&quot;&quot;</span>
    <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

    <span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span> <span class="o">%</span> <span class="n">xsize</span>
    <span class="k">if</span> <span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">image</span>

    <span class="n">part1</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">part2</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">crop</span><span class="p">((</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">part1</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">part2</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
    <span class="n">image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">part2</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>
    <span class="n">image</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">part1</span><span class="p">,</span> <span class="p">(</span><span class="n">xsize</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">xsize</span><span class="p">,</span> <span class="n">ysize</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">image</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;demo.jpg&quot;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">roll</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="image.png" src="https://upload-images.jianshu.io/upload_images/10819934-6d00235825d1ea77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"></p>
<p>[代码地址]https://github.com/china-testing/python-api-tesing/tree/master/python3_libraries/pillow)</p>
<p>请注意粘贴时首先调用crop(),如果未调用则在paste命令中使用图像之前，不会执行裁剪操作。这意味着part1会从第一次粘贴已经修改的图像版本中剪切掉。</p>
<p>粘贴方法也可以将透明度掩码作为可选参数。在此掩码中，值255表示粘贴的图像在该位置不透明（即按原样使用粘贴的图像）。值0表示粘贴的图像是完全透明的。中间值表示不同级别的透明度。例如，粘贴RGBA图像并将其用作蒙版将粘贴图像的不透明部分，但不粘贴透明背景。</p>
<p>PIL还允许您使用多波段图像的各个波段，例如RGB图像。拆分方法会创建新图像，每个图像都包含原始多波段图像中的一个波段。合并功能采用模式和图像元组，并将它们组合成新图像。以下示例交换RGB图像的三个波段：</p>
<p>分割和合并色带</p>
<div class="highlight"><pre><span></span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>
</pre></div>


<p>注意，对于单波段图像，split()会返回图像本身。要使用单独的色带，可能首先要将图像转换为“RGB”。</p>
<h3 id="_6">几何变换</h3>
<p>PIL.Image.Image类包含调整resize()和rotate()图像的方法。前者需要给出尺寸的元组，后者是逆时针方向的角度。</p>
<p>简单的几何变换</p>
<div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span> <span class="c1"># degrees counter-clockwise</span>
</pre></div>


<p>要以90度的步幅旋转图像，您可以使用rotate()方法或transpose()方法。后者也可用于翻转水平或垂直轴周围的图像。</p>
<p>转置图像</p>
<div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_TOP_BOTTOM</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">ROTATE_90</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">ROTATE_180</span><span class="p">)</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">ROTATE_270</span><span class="p">)</span>
</pre></div>


<p>如果expand标志为真，transpose(ROTATE)操作也可以与rotate()操作完全相同，以提供与图像大小相同的更改。</p>
<p>可以通transform()方法执行更常用的图像转换。</p>
<p>示例： </p>
<div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python3</span>
<span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Author:    xurongzhong#126.com 技术支持qq群：6089740</span>
<span class="c1"># CreateDate: 2018-3-27</span>
<span class="c1"># rotate.py</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span> 
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">file_</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;{}{}{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_</span><span class="p">))</span>
        <span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<span class="n">src</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/home/andrew/code/tmp_photos&#39;</span>
<span class="n">dst</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;/home/andrew/code/tmp_photos2&#39;</span>

<span class="n">common</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;{}{}*.*&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">))</span>  
<span class="n">rotate</span><span class="p">(</span><span class="n">common</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
</pre></div>


<p><a href="https://github.com/china-testing/python-api-tesing/tree/master/python3_libraries/pillow">代码地址</a></p>
<h3 id="_7">颜色转换</h3>
<p>PIL允许您使用convert() 方法在不同的像素表示之间转换图像。</p>
<h3 id="_8">模式转换</h3>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;hopper.ppm&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
</pre></div>


<p>该库支持每种支持模式和“L”和“RGB”模式之间的转换。要在其他模式之间转换，您可能必须使用中间图像(通常是“RGB”)图像。</p>
<h3 id="_9">图像增强</h3>
<p>PIL提供了许多可用于增强图像的方法和模块。</p>
<ul>
<li>过滤器</li>
</ul>
<p>ImageFilter模块包含许多可以与filter()方法一起使用的预定义增强过滤器。</p>
<p>应用过滤器</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageFilter</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ImageFilter</span><span class="o">.</span><span class="n">DETAIL</span><span class="p">)</span>
</pre></div>


<ul>
<li>点操作
point()方法可用于转换图像的像素值(例如图像对比度操作)。在大多数情况下，期望一个参数的函数对象可以传递给此方法。每个像素都根据该功能进行处理：</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># multiply each pixel by 1.2</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">)</span>
</pre></div>


<p>使用上述技巧，您可以快速将任何简单表达式应用于图像。你也可以结合point()和paste()方法来选择性地修改图像：</p>
<p>处理单个色带</p>
<div class="highlight"><pre><span></span><span class="c1"># split the image into individual bands</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="n">R</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>

<span class="c1"># select regions where red is less than 100</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">R</span><span class="p">]</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="ow">and</span> <span class="mi">255</span><span class="p">)</span>

<span class="c1"># process the green band</span>
<span class="n">out</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">.</span><span class="n">point</span><span class="p">(</span><span class="k">lambda</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># paste the processed band back, but only where red was &lt; 100</span>
<span class="n">source</span><span class="p">[</span><span class="n">G</span><span class="p">]</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mask</span><span class="p">)</span>

<span class="c1"># build a new multiband image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</pre></div>


<p>Python仅根据确定结果所需的逻辑表达式部分进行评估，并返回检查的最后值作为表达式的结果。因此，如果上面的表达式为假（0），Python不会查看第二个操作数，并返回0.否则，返回255。</p>
<ul>
<li>增强</li>
</ul>
<p>对于更高级的图像增强，您可以使用ImageEnhance模块中的类。从图像创建后，可以使用增强对象快速尝试不同的设置。</p>
<p>您可以用这种方式调整对比度，亮度，色彩平衡和清晰度。</p>
<p>增强图像</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageEnhance</span>

<span class="n">enh</span> <span class="o">=</span> <span class="n">ImageEnhance</span><span class="o">.</span><span class="n">Contrast</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="n">enh</span><span class="o">.</span><span class="n">enhance</span><span class="p">(</span><span class="mf">1.3</span><span class="p">)</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="s2">&quot;30% more contrast&quot;</span><span class="p">)</span>
</pre></div>


<h3 id="_10">图像序列</h3>
<p>Python图像库包含对图像序列（也称为动画格式）的一些基本支持。支持的序列格式包括FLI/FLC, GIF和一些实验格式。 TIFF文件也可以包含多个帧。</p>
<p>当你打开一个序列文件时，PIL自动加载序列中的第一帧。您可以使用seek和tell方法在不同的帧之间移动：</p>
<p>读序列</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;animation.gif&quot;</span><span class="p">)</span>
<span class="n">im</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># skip to the second frame</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">im</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># do something to im</span>
<span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
    <span class="k">pass</span> <span class="c1"># end of sequence</span>
</pre></div>


<p>正如在这个例子中看到的，当序列结束时，你会得到EOFError异常。</p>
<p>注意当前版本库中的大多数驱动程序只允许您寻找下一帧（如上例所示）。要倒回文件，您可能必须重新打开它。</p>
<p>下面的类让你使用for语句来遍历序列：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">ImageSequence</span>
<span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">ImageSequence</span><span class="o">.</span><span class="n">Iterator</span><span class="p">(</span><span class="n">im</span><span class="p">):</span>
    <span class="c1"># ...do something to frame...</span>
</pre></div>


<p>后记打印
Python影像库包括在Postscript打印机上打印图像，文本和图形的功能。这里有一个简单的例子：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">PSDraw</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;hopper.ppm&quot;</span><span class="p">)</span>
<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;hopper&quot;</span>
<span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="mi">7</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="mi">10</span><span class="o">*</span><span class="mi">72</span><span class="p">)</span> <span class="c1"># in points</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">PSDraw</span><span class="o">.</span><span class="n">PSDraw</span><span class="p">()</span> <span class="c1"># default is sys.stdout</span>
<span class="n">ps</span><span class="o">.</span><span class="n">begin_document</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="c1"># draw the image (75 dpi)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="mi">75</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>

<span class="c1"># draw title</span>
<span class="n">ps</span><span class="o">.</span><span class="n">setfont</span><span class="p">(</span><span class="s2">&quot;HelveticaNarrow-Bold&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">)</span>
<span class="n">ps</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="mi">72</span><span class="p">,</span> <span class="mi">4</span><span class="o">*</span><span class="mi">72</span><span class="p">),</span> <span class="n">title</span><span class="p">)</span>

<span class="n">ps</span><span class="o">.</span><span class="n">end_document</span><span class="p">()</span>
</pre></div>


<p>更多关于读图片</p>
<p>如前所述，Image模块的open() 函数用于打开图像文件。在大多数情况下，您只需将文件名作为参数传递给它：</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;hopper.ppm&quot;</span><span class="p">)</span>
</pre></div>


<p>如果一切顺利，结果是一个PIL.Image.Image对象。否则，会引发IOError异常。</p>
<p>您可以使用文件类对象而不是文件名。该对象必须实现read(), seek()和tell()方法，并以二进制模式打开。</p>
<p>从打开的文件中读取</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;hopper.ppm&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</pre></div>


<p>要从字符串数据读取图像，请使用StringIO类：</p>
<p>从字符串中读取</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">StringIO</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="nb">buffer</span><span class="p">))</span>
</pre></div>


<p>请注意，在读取图像标题之前，库会回滚文件(使用seek(0)）。另外，当读取图像数据时(通过加载方法)，也将使用seek。如果映像文件嵌入到较大的文件中，例如tar文件，则可以使用ContainerIO或TarIO模块访问它。</p>
<p>从tar档案中读取</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">TarIO</span>

<span class="n">fp</span> <span class="o">=</span> <span class="n">TarIO</span><span class="o">.</span><span class="n">TarIO</span><span class="p">(</span><span class="s2">&quot;Tests/images/hopper.tar&quot;</span><span class="p">,</span> <span class="s2">&quot;hopper.jpg&quot;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</pre></div>


<h3 id="_11">控制解码器</h3>
<p>某些解码器允许您在从文件中读取图像的同时操作图像。当创建缩略图时（速度通常比质量更重要）和打印到黑白激光打印机（只需要灰度版本的图像时）时，通常可以使用此功能来加速解码。</p>
<p>draft() 方法处理已打开但尚未加载的图像，以便尽可能匹配给定的模式和大小。这是通过重新配置图像解码器完成的。</p>
<p>以草稿模式阅读
这仅适用于JPEG和MPO文件。</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;original =&quot;</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

<span class="n">im</span><span class="o">.</span><span class="n">draft</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s2">&quot;draft =&quot;</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">im</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</pre></div>


<p>这样打印出如下内容：</p>
<div class="highlight"><pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">RGB</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">)</span>
<span class="n">draft</span> <span class="o">=</span> <span class="n">L</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
</pre></div>


<p>请注意，生成的图像可能不完全符合请求的模式和尺寸。为确保图像不大于给定大小，请改用缩略图方法。</p>
<h2 id="_12">参考资料</h2>
<ul>
<li>python测试等IT技术支持qq群： 144081101(后期会录制视频存在该群群文件) 591302926 567351477 </li>
<li>道家技术-手相手诊看相中医等钉钉群21734177 qq群：391441566 184175668 338228106 看手相、面相、舌相、抽签、体质识别。服务费50元每人次起。请联系钉钉或者微信pythontesting</li>
<li><a href="https://china-testing.github.io/python3_lib_telnetlib.html">本文最新版本地址</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing">本文涉及的python测试开发库</a> 谢谢点赞！</li>
<li><a href="https://github.com/china-testing/python-api-tesing/blob/master/books.md">本文相关海量书籍下载</a></li>
<li><a href="https://china-testing.github.io/testing_training.html">接口自动化性能测试线上培训大纲</a></li>
<li>python官方文档：https://docs.python.org/3/library/telnetlib.html</li>
<li>pymotw文档：https://pymotw.com/3/enum/index.html</li>
<li>effbot: http://effbot.org/librarybook/telnetlib.htm</li>
<li>rfc854: https://tools.ietf.org/html/rfc854.html</li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://china-testing.github.io/testing_training.html">自动化性能接口测试线上及深圳培训与项目实战 qq群：144081101 591302926</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">pandas数据分析scrapy爬虫 521070358 Py人工智能pandas-opencv 6089740</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">中医解梦看相八字算命qq群 391441566 csdn书籍下载-python爬虫 437355848</a></li>
                        </ul>
                </div><!-- /.blogroll -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>