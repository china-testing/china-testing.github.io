<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>使用pandas处理excel</title>
        <link rel="stylesheet" href="/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">python自动化测试人工智能 </a></h1>
                <nav><ul>
                    <li><a href="/category/ce-shi.html">测试</a></li>
                    <li><a href="/category/ce-shi-kuang-jia.html">测试框架</a></li>
                    <li><a href="/category/common.html">common</a></li>
                    <li><a href="/category/ji-qi-xue-xi.html">机器学习</a></li>
                    <li><a href="/category/linux.html">linux</a></li>
                    <li class="active"><a href="/category/python.html">python</a></li>
                    <li><a href="/category/shu-ju-fen-xi.html">数据分析</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/python_pandas_excel.html" rel="bookmark"
           title="Permalink to 使用pandas处理excel">使用pandas处理excel</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-02-11T19:20:00+08:00">
                Published: 日 11 二月 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew.html">andrew</a>
        </address>
<p>In <a href="/category/python.html">python</a>.</p>

</footer><!-- /.post-info -->      <p>pandas有强大的excel数据处理和导入处理功能，本文简单介绍pandas在csv和excel等格式方面处理的应用及绘制图表等功能。</p>
<p>pandas处理excel依赖xlutils, OpenPyXL, XlsxWriter等库。</p>
<ul>
<li>
<p>python处理excel库的参考：https://github.com/xurongzhong/mobile_data</p>
</li>
<li>
<p>本文代码地址：https://github.com/xurongzhong/mobile_data/tree/master/pandas/excel_demo</p>
</li>
<li>
<p><a href="https://xurongzhong.github.io/">本文最新版本地址</a></p>
</li>
<li>
<p>技术支持： QQ群：python 测试开发自动化测试 630011153 </p>
</li>
<li>
<p>你的赞助是我们前进的动力：</p>
</li>
</ul>
<p>一流企业专家自动化性能接口测试 数据分析 python一对一教，非骗人的培训机构(多数大陆培训机构的老师实际未入门）承接excel合并，电脑自动化操作等工程 联系qq：37391319 并欢迎讨论中医草药风水相学等道家国学</p>
<p>交流QQ群：python 测试开发自动化测试 144081101  Python数据分析pandas Excel 630011153 中医草药自学自救大数据 391441566 南方中医草药鉴别学习 184175668 中医草药湿热湿疹胃病 291184506 python高级人工智能视觉 6089740</p>
<p>更多参考资料：</p>
<p>https://www.dataquest.io/blog/excel-and-pandas/</p>
<p><a href="https://realpython.com/blog/python/working-with-large-excel-files-in-pandas/">Using Pandas to Read Large Excel Files in Python</a> <a href="https://python.freelycode.com/contribution/detail/38">中文</a></p>
<p>Foundations for Analytics with Python From Non-Programmer to Hacker - 2016.pdf</p>
<p>Python for Data Analysis, 2nd Edition - 2017.pdf</p>
<h2>pandas数据读取概述</h2>
<h3>读写文本</h3>
<table>
<thead>
<tr>
<th align="center">Function</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">read_csv</td>
<td align="center">Load delimited data from a file, URL, or file-like object; use comma as default delimiter</td>
</tr>
<tr>
<td align="center">read_table</td>
<td align="center">Load delimited data from a file, URL, or file-like object; use tab ('\t') as default delimiter</td>
</tr>
<tr>
<td align="center">read_fwf</td>
<td align="center">Read data in fixed-width column format (i.e., no delimiters)</td>
</tr>
<tr>
<td align="center">read_clipboard Version of</td>
<td align="center">Read_table that</td>
</tr>
<tr>
<td align="center">pages</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">read_excel</td>
<td align="center">Read tabular data from an Excel XLS or XLSX file</td>
</tr>
<tr>
<td align="center">read_hdf</td>
<td align="center">Read HDF5 files written by pandas</td>
</tr>
<tr>
<td align="center">read_html</td>
<td align="center">Read all tables found in the given HTML document</td>
</tr>
<tr>
<td align="center">read_json</td>
<td align="center">Read data from a JSON (JavaScript Object Notation) string representation</td>
</tr>
<tr>
<td align="center">read_msgpack</td>
<td align="center">Read pandas data encoded using the MessagePack binary format</td>
</tr>
<tr>
<td align="center">read_pickle</td>
<td align="center">Read an arbitrary object stored in Python pickle format</td>
</tr>
<tr>
<td align="center">read_sas</td>
<td align="center">Read a SAS dataset stored in one of the SAS system’s custom storage formats</td>
</tr>
<tr>
<td align="center">read_sql</td>
<td align="center">Read the results of a SQL query (using SQLAlchemy) as a pandas DataFrame</td>
</tr>
<tr>
<td align="center">read_stata</td>
<td align="center">Read a dataset from Stata file format</td>
</tr>
<tr>
<td align="center">read_feather</td>
<td align="center">Read the Feather binary file format</td>
</tr>
</tbody>
</table>
<p>参数主要涉及索引、类型推理和数据转换、日期时间处理、迭代、脏数据。</p>
<p>ex1.csv的内容如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">message</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">hello</span>
<span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">world</span>
<span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>读取：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex1.csv&#39;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">df</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">10</span><span class="p">]:</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">hello</span>
<span class="mi">1</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>还可以改用read_table读取</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;examples/ex1.csv&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">hello</span>
<span class="mi">1</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>ex2.csv的内容如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">hello</span>
<span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">world</span>
<span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>可以使用header=None表示没有列名，也可以用names自行指定列名，还可以使用index_col将列作为索引。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex2.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">13</span><span class="p">]:</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">hello</span>
<span class="mi">1</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="n">foo</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex2.csv&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">hello</span>
<span class="mi">1</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="n">foo</span>
<span class="mf">6.1</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex2.csv&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;message&#39;</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">16</span><span class="p">]:</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span>
<span class="n">message</span>
<span class="n">hello</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="n">world</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span>
<span class="n">foo</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span>
</pre></div>
</td></tr></table>

<p>csv_mindex.csv的内容：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">key1</span><span class="p">,</span><span class="n">key2</span><span class="p">,</span><span class="n">value1</span><span class="p">,</span><span class="n">value2</span>
<span class="n">one</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span>
<span class="n">one</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>
<span class="n">one</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span>
<span class="n">one</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span>
<span class="n">two</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span>
<span class="n">two</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span>
<span class="n">two</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span>
<span class="n">two</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span>
</pre></div>
</td></tr></table>

<p>建立层级索引：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">parsed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/csv_mindex.csv&#39;</span><span class="p">,</span>
<span class="o">....</span><span class="p">:</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;key1&#39;</span><span class="p">,</span> <span class="s1">&#39;key2&#39;</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">parsed</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span>
<span class="n">value1</span> <span class="n">value2</span>
<span class="n">key1</span> <span class="n">key2</span>
<span class="n">one</span> <span class="n">a</span> <span class="mi">1</span> <span class="mi">2</span>
<span class="n">b</span> <span class="mi">3</span> <span class="mi">4</span>
<span class="n">c</span> <span class="mi">5</span> <span class="mi">6</span>
<span class="n">d</span> <span class="mi">7</span> <span class="mi">8</span>
<span class="n">two</span> <span class="n">a</span> <span class="mi">9</span> <span class="mi">10</span>
<span class="n">b</span> <span class="mi">11</span> <span class="mi">12</span>
<span class="n">c</span> <span class="mi">13</span> <span class="mi">14</span>
<span class="n">d</span> <span class="mi">15</span> <span class="mi">16</span>
</pre></div>
</td></tr></table>

<p>用正则表达式处理混合的分隔符：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;examples/ex3.txt&#39;</span><span class="p">))</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">20</span><span class="p">]:</span>
<span class="p">[</span><span class="s1">&#39; A B C</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="s1">&#39;aaa -0.264438 -1.026059 -0.619500</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="s1">&#39;bbb 0.927272 0.302904 -0.032399</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="s1">&#39;ccc -0.264273 -0.386314 -0.217601</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
<span class="s1">&#39;ddd -0.871858 -0.348382 1.100491</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;examples/ex3.txt&#39;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;\s+&#39;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">22</span><span class="p">]:</span>
<span class="n">A</span> <span class="n">B</span> <span class="n">C</span>
<span class="n">aaa</span> <span class="o">-</span><span class="mf">0.264438</span> <span class="o">-</span><span class="mf">1.026059</span> <span class="o">-</span><span class="mf">0.619500</span>
<span class="n">bbb</span> <span class="mf">0.927272</span> <span class="mf">0.302904</span> <span class="o">-</span><span class="mf">0.032399</span>
<span class="n">ccc</span> <span class="o">-</span><span class="mf">0.264273</span> <span class="o">-</span><span class="mf">0.386314</span> <span class="o">-</span><span class="mf">0.217601</span>
<span class="n">ddd</span> <span class="o">-</span><span class="mf">0.871858</span> <span class="o">-</span><span class="mf">0.348382</span> <span class="mf">1.100491</span>
</pre></div>
</td></tr></table>

<p>ex4.csv的内容：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># hey!</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">message</span>
<span class="c1"># just wanted to make things more difficult for you</span>
<span class="c1"># who reads CSV files with computers, anyway?</span>
<span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">hello</span>
<span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="n">world</span>
<span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>skiprows可以忽略行</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex4.csv&#39;</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span>
<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="n">hello</span>
<span class="mi">1</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>ex5.csv的内容：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">something</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">message</span>
<span class="n">one</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="n">NA</span>
<span class="n">two</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,,</span><span class="mi">8</span><span class="p">,</span><span class="n">world</span>
<span class="n">three</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="n">foo</span>
</pre></div>
</td></tr></table>

<p>可以指定哪些值为缺失值，甚至可以针对行指定缺失值。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex5.csv&#39;</span><span class="p">)</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">27</span><span class="p">]:</span>
<span class="n">something</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="n">one</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.0</span> <span class="mi">4</span> <span class="n">NaN</span>
<span class="mi">1</span> <span class="n">two</span> <span class="mi">5</span> <span class="mi">6</span> <span class="n">NaN</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="n">three</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mf">11.0</span> <span class="mi">12</span> <span class="n">foo</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">28</span><span class="p">]:</span>
<span class="n">something</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">True</span>
<span class="mi">1</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">True</span> <span class="bp">False</span> <span class="bp">False</span>
<span class="mi">2</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span> <span class="bp">False</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex5.csv&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NULL&#39;</span><span class="p">])</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">result</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">30</span><span class="p">]:</span>
<span class="n">something</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="n">one</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.0</span> <span class="mi">4</span> <span class="n">NaN</span>
<span class="mi">1</span> <span class="n">two</span> <span class="mi">5</span> <span class="mi">6</span> <span class="n">NaN</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="n">three</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mf">11.0</span> <span class="mi">12</span> <span class="n">foo</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">sentinels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;NA&#39;</span><span class="p">],</span> <span class="s1">&#39;something&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;two&#39;</span><span class="p">]}</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;examples/ex5.csv&#39;</span><span class="p">,</span> <span class="n">na_values</span><span class="o">=</span><span class="n">sentinels</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">32</span><span class="p">]:</span>
<span class="n">something</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="n">d</span> <span class="n">message</span>
<span class="mi">0</span> <span class="n">one</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mf">3.0</span> <span class="mi">4</span> <span class="n">NaN</span>
<span class="mi">1</span> <span class="n">NaN</span> <span class="mi">5</span> <span class="mi">6</span> <span class="n">NaN</span> <span class="mi">8</span> <span class="n">world</span>
<span class="mi">2</span> <span class="n">three</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mf">11.0</span> <span class="mi">12</span> <span class="n">NaN</span>
</pre></div>
</td></tr></table>

<p>pandas.read_csv和pandas.read_table的常用参数如下：</p>
<table>
<thead>
<tr>
<th align="center">Argument</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">path</td>
<td align="center">String indicating filesystem location, URL, or file-like object</td>
</tr>
<tr>
<td align="center">sep or delimiter</td>
<td align="center">Character sequence or regular expression to use to split fields in each row</td>
</tr>
<tr>
<td align="center">header</td>
<td align="center">Row number to use as column names; defaults to 0 (first row), but should be None if there is no header row。</td>
</tr>
<tr>
<td align="center">index_col</td>
<td align="center">Column numbers or names to use as the row index in the result; can be a single name/number or alist of them for a hierarchical index</td>
</tr>
<tr>
<td align="center">names</td>
<td align="center">List of column names for result, combine with header=None</td>
</tr>
<tr>
<td align="center">skiprows</td>
<td align="center">Number of rows at beginning of file to ignore or list of row numbers (starting from 0) to skip.</td>
</tr>
<tr>
<td align="center">na_values</td>
<td align="center">Sequence of values to replace with NA.</td>
</tr>
<tr>
<td align="center">comment</td>
<td align="center">Character(s) to split comments off the end of lines.</td>
</tr>
<tr>
<td align="center">parse_dates</td>
<td align="center">Attempt to parse data to datetime; False by default. If True, will attempt to parse all columns.Otherwise can specify a list of column numbers or name to parse. If element of list is tuple or list, willcombine multiple columns together and parse to date (e.g., if date/time split across two columns).</td>
</tr>
<tr>
<td align="center">keep_date_col</td>
<td align="center">If joining columns to parse date, keep the joined columns; False by default.</td>
</tr>
<tr>
<td align="center">converters</td>
<td _foo_:="'foo':" align="center" f>Dict containing column number of name mapping to functions (e.g., </td>
</tr>
<tr>
<td align="center">dayfirst</td>
<td align="center">When parsing potentially ambiguous dates, treat as international format (e.g., 7/6/2012 -&gt; June 7,2012); False by default.</td>
</tr>
<tr>
<td align="center">date_parser</td>
<td align="center">Function to use to parse dates.</td>
</tr>
<tr>
<td align="center">nrows</td>
<td align="center">Number of rows to read from beginning of file.</td>
</tr>
<tr>
<td align="center">iterator</td>
<td align="center">Return a TextParser object for reading file piecemeal.</td>
</tr>
<tr>
<td align="center">chunksize</td>
<td align="center">For iteration, size of file chunks.</td>
</tr>
<tr>
<td align="center">skip_footer</td>
<td align="center">Number of lines to ignore at end of file.</td>
</tr>
<tr>
<td align="center">verbose</td>
<td align="center">Print various parser output information, like the number of missing values placed in non-numericcolumns.</td>
</tr>
<tr>
<td align="center">encoding</td>
<td align="center">Text encoding for Unicode (e.g., 'utf-8' for UTF-8 encoded text).</td>
</tr>
<tr>
<td align="center">squeeze</td>
<td align="center">If the parsed data only contains one column, return a Series.</td>
</tr>
<tr>
<td align="center">thousands</td>
<td align="center">Separator for thousands (e.g., ',' or '.').</td>
</tr>
</tbody>
</table>
<p>更多参考：https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html</p>
<h2>CSV</h2>
<h3>使用pandas读写csv</h3>
<p>pandas_parsing_and_write.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\1output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="n">data_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>当然也可以用python实现：</p>
<p>1csv_simple_parsing_and_write.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\1output.csv&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filereader</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">filewriter</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">filereader</span><span class="p">:</span>
            <span class="n">filewriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>2csv_reader_parsing_and_write.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\2output.csv&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_in_file</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csv_out_file</span><span class="p">:</span>
        <span class="n">filereader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">(</span><span class="n">csv_in_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">filewriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csv_out_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">row_list</span> <span class="ow">in</span> <span class="n">filereader</span><span class="p">:</span>
            <span class="n">filewriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row_list</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3>过滤特定行</h3>
<ul>
<li>选择供应商名字包含Z或者Cost大于600的行</li>
</ul>
<p>pandas_value_meets_condition.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\3output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

<span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<span class="n">data_frame_value_meets_condition</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Supplier Name&#39;</span><span class="p">]</span>\
<span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">))</span> <span class="o">|</span> <span class="p">(</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">600.0</span><span class="p">),</span> <span class="p">:]</span>

<span class="n">data_frame_value_meets_condition</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>注意pandas的strip连里面的内容都可以清除, 有点类似replace的功能。</p>
<ul>
<li>选择符合一个集合的数据：</li>
</ul>
<p>选择日期为'1/20/14', '1/30/14'的行</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\4output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

<span class="n">important_dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;1/20/14&#39;</span><span class="p">,</span> <span class="s1">&#39;1/30/14&#39;</span><span class="p">]</span>
<span class="n">data_frame_value_in_set</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Purchase Date&#39;</span><span class="p">]</span>\
<span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">important_dates</span><span class="p">),</span> <span class="p">:]</span>

<span class="n">data_frame_value_in_set</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li>用正则表达式选择数据</li>
</ul>
<p>pandas_value_matches_pattern.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\4output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">data_frame_value_matches_pattern</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Invoice Number&#39;</span><span class="p">]</span>\
<span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;001-&quot;</span><span class="p">),</span> <span class="p">:]</span>

<span class="n">data_frame_value_matches_pattern</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3>过滤特定列</h3>
<ul>
<li>选择0,3列</li>
</ul>
<p>pandas_column_by_index.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\6output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">data_frame_column_by_index</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="n">data_frame_column_by_index</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>pandas_column_by_index.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\7output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<span class="n">data_frame_column_by_name</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">:,</span> <span class="p">[</span><span class="s1">&#39;Invoice Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Purchase Date&#39;</span><span class="p">]]</span>
<span class="n">data_frame_column_by_name</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>pandas_select_contiguous_rows.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data_unnecessary_header_footer.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\11output.csv&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">])</span>
<span class="n">data_frame</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">data_frame</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">data_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
<span class="n">data_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3>添加行头</h3>
<p>pandas_add_header_row.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;supplier_data_no_header_row.csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\11output.csv&quot;</span>
<span class="n">header_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Supplier Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Invoice Number&#39;</span><span class="p">,</span> \
<span class="s1">&#39;Part Number&#39;</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">,</span> <span class="s1">&#39;Purchase Date&#39;</span><span class="p">]</span>
<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">header_list</span><span class="p">)</span>
<span class="n">data_frame</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3>合并多个文件</h3>
<p>pandas_concat_rows_from_multiple_files.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">input_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\code\foundations-for-analytics-with-python\csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\12output.csv&quot;</span>

<span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span><span class="s1">&#39;sales_*&#39;</span><span class="p">))</span>
<span class="n">all_data_frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="nb">file</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">all_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>
<span class="n">data_frame_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data_frame_concat</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3>求和和求平均值</h3>
<p>pandas_sum_average_from_multiple_files.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">input_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\code\foundations-for-analytics-with-python\csv&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;output_files\12output.csv&quot;</span>

<span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span><span class="s1">&#39;sales_*&#39;</span><span class="p">))</span>
<span class="n">all_data_frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">input_file</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
    <span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">print</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>

    <span class="n">sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> 
      <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Sale Amount&#39;</span><span class="p">]])</span>

    <span class="n">total_cost</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">average_cost</span> <span class="o">=</span> <span class="n">sales</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file_name&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">input_file</span><span class="p">),</span>
            <span class="s1">&#39;total_sales&#39;</span><span class="p">:</span> <span class="n">total_cost</span><span class="p">,</span>
            <span class="s1">&#39;average_sales&#39;</span><span class="p">:</span> <span class="n">average_cost</span><span class="p">}</span>

    <span class="n">all_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;file_name&#39;</span><span class="p">,</span> <span class="s1">&#39;total_sales&#39;</span><span class="p">,</span> <span class="s1">&#39;average_sales&#39;</span><span class="p">]))</span>

<span class="n">data_frames_concat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">data_frames_concat</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2>XLS</h2>
<h3>使用pandas读写xls</h3>
<p>pandas_parsing_and_write_keep_dates.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>
<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">sheetname</span><span class="o">=</span><span class="s1">&#39;january_2013&#39;</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>过滤特定行</h3>
<ul>
<li>销售额大于1400的记录</li>
</ul>
<p>pandas_value_meets_condition.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;january_2013&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">data_frame_value_meets_condition</span> <span class="o">=</span> \
    <span class="n">data_frame</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Sale Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1400.0</span><span class="p">]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame_value_meets_condition</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<ul>
<li>指定日期的</li>
</ul>
<p>pandas_value_in_set.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">string</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;january_2013&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">important_dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;01/24/2013&#39;</span><span class="p">,</span><span class="s1">&#39;01/31/2013&#39;</span><span class="p">]</span>
<span class="n">data_frame_value_in_set</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Purchase Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">important_dates</span><span class="p">)]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame_value_in_set</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<ul>
<li>其他条件</li>
</ul>
<p>startswith , endswith , match和search等。</p>
<p>pandas_value_matches_pattern.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;january_2013&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">data_frame_value_matches_pattern</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span>
    <span class="n">data_frame</span><span class="p">[</span><span class="s1">&#39;Customer Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;J&quot;</span><span class="p">)]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame_value_matches_pattern</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>选取特定列</h3>
<ul>
<li>iloc基于ｉｎｄｅｘ选取第２和第５列</li>
</ul>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;january_2013&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">data_frame_column_by_index</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame_column_by_index</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<ul>
<li>loc基于列名选取第２和第５列</li>
</ul>
<p>pandas_column_by_name.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;january_2013&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">data_frame_column_by_name</span> <span class="o">=</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Customer ID&#39;</span><span class="p">,</span> <span class="s1">&#39;Purchase Date&#39;</span><span class="p">]]</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">data_frame_column_by_name</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;jan_13_output&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>操作所有sheet</h3>
<ul>
<li>选取销售额大于2000的行</li>
</ul>
<p>pandas_value_meets_condition_all_worksheets.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">sheetname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">row_output</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">row_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sale Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>
                           <span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2000.0</span><span class="p">])</span>
<span class="n">filtered_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">row_output</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">filtered_rows</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sale_amount_gt2000&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<ul>
<li>loc基于列名选取所有sheet的第2和第5列</li>
</ul>
<p>pandas_value_meets_condition_all_worksheets.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">column_output</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">column_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Customer Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Sale Amount&#39;</span><span class="p">]])</span>
<span class="n">selected_columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">column_output</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">selected_columns</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
        <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;selected_columns_all_worksheets&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>操作部分sheet</h3>
<ul>
<li>选取销售额大于２０００的行</li>
</ul>
<p>pandas_value_meets_condition_set_of_worksheets.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">input_file</span> <span class="o">=</span> <span class="s2">&quot;sales_2013.xlsx&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">my_sheets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">1900.0</span>

<span class="n">data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">sheetname</span><span class="o">=</span><span class="n">my_sheets</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="n">row_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_frame</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">row_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;Sale Amount&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span>
                         <span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">])</span>
<span class="n">filtered_rows</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">row_list</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">filtered_rows</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;set_of_worksheets&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>处理多个excel</h3>
<ul>
<li>连接concat</li>
</ul>
<p>pandas_concat_data_from_multiple_workbooks.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">input_path</span> <span class="o">=</span> <span class="s2">&quot;/media/andrew/6446FA2346F9F5A0/code/foundations-for-analytics-</span><span class="se">\</span>
<span class="s2">with-python/excel&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">all_workbooks</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span><span class="s1">&#39;*.xls*&#39;</span><span class="p">))</span>
<span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">workbook</span> <span class="ow">in</span> <span class="n">all_workbooks</span><span class="p">:</span>
    <span class="n">all_worksheets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
            <span class="n">workbook</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">all_worksheets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">all_data_concatenated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">all_data_concatenated</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
        <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;all_data_all_workbooks&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<ul>
<li>求和</li>
</ul>
<p>pandas_sum_average_multiple_workbooks.py</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">input_path</span> <span class="o">=</span> <span class="s2">&quot;/media/andrew/6446FA2346F9F5A0/code/foundations-for-analytics-</span><span class="se">\</span>
<span class="s2">with-python/excel&quot;</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;pandas_output.xls&quot;</span>

<span class="n">all_workbooks</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_path</span><span class="p">,</span><span class="s1">&#39;*.xls*&#39;</span><span class="p">))</span>
<span class="n">data_frames</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">workbook</span> <span class="ow">in</span> <span class="n">all_workbooks</span><span class="p">:</span>
    <span class="n">all_worksheets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">workbook</span><span class="p">,</span> <span class="n">sheetname</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="n">workbook_total_sales</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">workbook_number_of_sales</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">worksheet_data_frames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">worksheets_data_frame</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">workbook_data_frame</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="k">for</span> <span class="n">worksheet_name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">all_worksheets</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">total_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> 
             <span class="n">data</span><span class="o">.</span><span class="n">ix</span><span class="p">[:,</span> <span class="s1">&#39;Sale Amount&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">number_of_sales</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s1">&#39;Sale Amount&#39;</span><span class="p">])</span>
        <span class="n">average_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">total_sales</span> <span class="o">/</span> <span class="n">number_of_sales</span><span class="p">)</span>

        <span class="n">workbook_total_sales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">total_sales</span><span class="p">)</span>
        <span class="n">workbook_number_of_sales</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">number_of_sales</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;workbook&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">workbook</span><span class="p">),</span>
                <span class="s1">&#39;worksheet&#39;</span><span class="p">:</span> <span class="n">worksheet_name</span><span class="p">,</span>
                <span class="s1">&#39;worksheet_total&#39;</span><span class="p">:</span> <span class="n">total_sales</span><span class="p">,</span>
                <span class="s1">&#39;worksheet_average&#39;</span><span class="p">:</span> <span class="n">average_sales</span><span class="p">}</span>

        <span class="n">worksheet_data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> 
                         <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;workbook&#39;</span><span class="p">,</span> <span class="s1">&#39;worksheet&#39;</span><span class="p">,</span> <span class="s1">&#39;worksheet_total&#39;</span><span class="p">,</span> 
                                  <span class="s1">&#39;worksheet_average&#39;</span><span class="p">]))</span>
    <span class="n">worksheets_data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="n">worksheet_data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">workbook_total</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">workbook_total_sales</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">workbook_total_number_of_sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">workbook_number_of_sales</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">workbook_average</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">workbook_total</span> <span class="o">/</span> <span class="n">workbook_total_number_of_sales</span><span class="p">)</span>

    <span class="n">workbook_stats</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;workbook&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">workbook</span><span class="p">),</span>
                      <span class="s1">&#39;workbook_total&#39;</span><span class="p">:</span> <span class="n">workbook_total</span><span class="p">,</span>
                      <span class="s1">&#39;workbook_average&#39;</span><span class="p">:</span> <span class="n">workbook_average</span><span class="p">}</span>

    <span class="n">workbook_stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">workbook_stats</span><span class="p">,</span> 
                                  <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;workbook&#39;</span><span class="p">,</span> <span class="s1">&#39;workbook_total&#39;</span><span class="p">,</span>
                                           <span class="s1">&#39;workbook_average&#39;</span><span class="p">])</span>
    <span class="n">workbook_data_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">worksheets_data_frame</span><span class="p">,</span> <span class="n">workbook_stats</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;workbook&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">data_frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">workbook_data_frame</span><span class="p">)</span>

<span class="n">all_data_concatenated</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">data_frames</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
<span class="n">all_data_concatenated</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span>
    <span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;sums_and_averages&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h3>使用excel绘制图表</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="c1"># Some sample data to plot.</span>
<span class="n">cat_1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="s1">&#39;y3&#39;</span><span class="p">,</span> <span class="s1">&#39;y4&#39;</span><span class="p">]</span>
<span class="n">index_1</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">multi_iter1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="n">index_1</span><span class="p">}</span>
<span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="n">cat_1</span><span class="p">:</span>
    <span class="n">multi_iter1</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">index_1</span><span class="p">]</span>

<span class="c1"># Create a Pandas dataframe from the data.</span>
<span class="n">index_2</span> <span class="o">=</span> <span class="n">multi_iter1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">multi_iter1</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index_2</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>

<span class="c1"># Create a Pandas Excel writer using XlsxWriter as the engine.</span>
<span class="n">excel_file</span> <span class="o">=</span> <span class="s1">&#39;legend.xlsx&#39;</span>
<span class="n">sheet_name</span> <span class="o">=</span> <span class="s1">&#39;Sheet1&#39;</span>

<span class="n">writer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">excel_file</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">)</span>

<span class="c1"># Access the XlsxWriter workbook and worksheet objects from the dataframe.</span>
<span class="n">workbook</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">book</span>
<span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span>

<span class="c1"># Create a chart object.</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">workbook</span><span class="o">.</span><span class="n">add_chart</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;line&#39;</span><span class="p">})</span>

<span class="c1"># Configure the series of the chart from the dataframe data.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cat_1</span><span class="p">)):</span>
    <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">chart</span><span class="o">.</span><span class="n">add_series</span><span class="p">({</span>
        <span class="s1">&#39;name&#39;</span><span class="p">:</span>       <span class="p">[</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span>
        <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
        <span class="s1">&#39;values&#39;</span><span class="p">:</span>     <span class="p">[</span><span class="s1">&#39;Sheet1&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">col</span><span class="p">],</span>
    <span class="p">})</span>

<span class="c1"># Configure the chart axes.</span>
<span class="n">chart</span><span class="o">.</span><span class="n">set_x_axis</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Index&#39;</span><span class="p">})</span>
<span class="n">chart</span><span class="o">.</span><span class="n">set_y_axis</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;major_gridlines&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">}})</span>

<span class="c1"># Insert the chart into the worksheet.</span>
<span class="n">worksheet</span><span class="o">.</span><span class="n">insert_chart</span><span class="p">(</span><span class="s1">&#39;G2&#39;</span><span class="p">,</span> <span class="n">chart</span><span class="p">)</span>

<span class="c1"># Close the Pandas Excel writer and output the Excel file.</span>
<span class="n">writer</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p><img alt="QQ图片20180123150151.png" src="https://bitbucket.org/repo/gaRxAK/images/1489351226-QQ%E5%9B%BE%E7%89%8720180123150151.png"></p>
<p>参考资料：http://pandas-xlsxwriter-charts.readthedocs.io/</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">自动化性能接口测试线上及深圳培训与项目实战 qq群：144081101 591302926</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">pandas数据分析scrapy爬虫 521070358 Py人工智能pandas-opencv 6089740</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">中医解梦看相八字算命qq群 391441566 csdn书籍下载-python爬虫 437355848</a></li>
                        </ul>
                </div><!-- /.blogroll -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>