<!DOCTYPE html>
<html lang="cn">
<head>
        <meta charset="utf-8" />
        <title>python库介绍-argparse: 命令行选项及参数解析</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">python自动化测试人工智能 </a></h1>
                <nav><ul>
                    <li><a href="/category/ce-shi.html">测试</a></li>
                    <li><a href="/category/ce-shi-kuang-jia.html">测试框架</a></li>
                    <li><a href="/category/common.html">common</a></li>
                    <li><a href="/category/feng-shui.html">风水</a></li>
                    <li><a href="/category/ji-qi-xue-xi.html">机器学习</a></li>
                    <li><a href="/category/jie-meng.html">解梦</a></li>
                    <li><a href="/category/linux.html">linux</a></li>
                    <li class="active"><a href="/category/python.html">python</a></li>
                    <li><a href="/category/shu-ji.html">书籍</a></li>
                    <li><a href="/category/shu-ju-fen-xi.html">数据分析</a></li>
                    <li><a href="/category/zhong-cao-yao.html">中草药</a></li>
                    <li><a href="/category/zhong-yi.html">中医</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/python3_lib_argparse.html" rel="bookmark"
           title="Permalink to python库介绍-argparse: 命令行选项及参数解析">python库介绍-argparse: 命令行选项及参数解析</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2018-03-27T19:20:00+08:00">
                Published: 二 27 三月 2018
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/andrew.html">andrew</a>
        </address>
<p>In <a href="/category/python.html">python</a>.</p>

</footer><!-- /.post-info -->      <h2 id="_1">快速入门</h2>
<p>argparse是一个完整的参数处理库。参数可以根据add_argument()的action选项触发不同action。支持的action有存储参数（单个，或作为列表的一部分）;存储常量的值（对布尔开关true/false有特殊处理）。默认动作是存储参数值。支持type(指定存储类型)和dest(指定存储变量)等参数。 </p>
<p>然后使用函数parse_args()进行参数解析，这个函数的输入默认是sys.argv[1:]，也可以使用其他字符串列表。选项使用GNU/POSIX语法处理，可以混合选项和参数值。parse_args的返回值是一个包含命令参数的Namespace。所有参数以属性的形式存在，比如args.myoption。</p>
<p>下面是一个简单的示例：argparse_short.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Short sample app&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;-bval&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">]))</span>
</pre></div>


<p>执行结果：</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_short</span><span class="o">.</span><span class="n">py</span>
<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>长参数argparse_long.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Example with long option names&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--noarg&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--witharg&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;witharg&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--witharg2&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;witharg2&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span>
        <span class="p">[</span><span class="s1">&#39;--noarg&#39;</span><span class="p">,</span> <span class="s1">&#39;--witharg&#39;</span><span class="p">,</span> <span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="s1">&#39;--witharg2=3&#39;</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_long</span><span class="o">.</span><span class="n">py</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">noarg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">witharg</span><span class="o">=</span><span class="s1">&#39;val&#39;</span><span class="p">,</span> <span class="n">witharg2</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>


<p>混合可选和必选参数：argparse_arguments.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Example with nonoptional arguments&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span> <span class="mi">3</span> <span class="n">inches</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span> <span class="n">some</span> <span class="n">inches</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">count</span> <span class="n">units</span>
<span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="n">count</span><span class="p">:</span> <span class="n">invalid</span> <span class="nb">int</span> <span class="n">value</span><span class="p">:</span>
<span class="s1">&#39;some&#39;</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">count</span> <span class="n">units</span>
<span class="n">argparse_arguments</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">the</span> <span class="n">following</span> <span class="n">arguments</span> <span class="n">are</span>
<span class="n">required</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span> <span class="n">units</span>
</pre></div>


<p>参数action有：</p>
<p>store：默认action模式，存储值到指定变量。
store_const：存储值在参数的const部分指定，多用于实现非布尔的命令行flag。
store_true / store_false：布尔开关。可以2个参数对应一个变量。
append：存储值到列表，该参数可以重复使用。
append_const：存储值到列表，存储值在参数的const部分指定。
version 输出版本信息然后退出。</p>
<p>下面是各种action的示例：argparse_action.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-s&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;simple_value&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Store a simple value&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_const&#39;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;constant_value&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="s1">&#39;value-to-store&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Store a constant value&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;boolean_t&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set a switch to true&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_false&#39;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;boolean_f&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set a switch to false&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;collection&#39;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Add repeated values to a list&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-A&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append_const&#39;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;const_collection&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="s1">&#39;value-1-to-append&#39;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="p">[],</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Add different values to list&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-B&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append_const&#39;</span><span class="p">,</span>
                    <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;const_collection&#39;</span><span class="p">,</span>
                    <span class="n">const</span><span class="o">=</span><span class="s1">&#39;value-2-to-append&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Add different values to list&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--version&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;version&#39;</span><span class="p">,</span>
                    <span class="n">version</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(prog)s</span><span class="s1"> 1.0&#39;</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;simple_value     = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">simple_value</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;constant_value   = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">constant_value</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;boolean_t        = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">boolean_t</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;boolean_f        = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">boolean_f</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;collection       = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">collection</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;const_collection = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">const_collection</span><span class="p">))</span>
</pre></div>


<p>执行结果如下，注意'simple_value'等被自动化转化为大写</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">SIMPLE_VALUE</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">t</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span><span class="p">]</span>
                          <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="n">COLLECTION</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">A</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">version</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>       <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">s</span> <span class="n">SIMPLE_VALUE</span>  <span class="n">Store</span> <span class="n">a</span> <span class="n">simple</span> <span class="n">value</span>
  <span class="o">-</span><span class="n">c</span>               <span class="n">Store</span> <span class="n">a</span> <span class="n">constant</span> <span class="n">value</span>
  <span class="o">-</span><span class="n">t</span>               <span class="n">Set</span> <span class="n">a</span> <span class="n">switch</span> <span class="n">to</span> <span class="n">true</span>
  <span class="o">-</span><span class="n">f</span>               <span class="n">Set</span> <span class="n">a</span> <span class="n">switch</span> <span class="n">to</span> <span class="n">false</span>
  <span class="o">-</span><span class="n">a</span> <span class="n">COLLECTION</span>    <span class="n">Add</span> <span class="n">repeated</span> <span class="n">values</span> <span class="n">to</span> <span class="n">a</span> <span class="nb">list</span>
  <span class="o">-</span><span class="n">A</span>               <span class="n">Add</span> <span class="n">different</span> <span class="n">values</span> <span class="n">to</span> <span class="nb">list</span>
  <span class="o">-</span><span class="n">B</span>               <span class="n">Add</span> <span class="n">different</span> <span class="n">values</span> <span class="n">to</span> <span class="nb">list</span>
  <span class="o">--</span><span class="n">version</span>        <span class="n">show</span> <span class="n">program</span><span class="s1">&#39;s version number and exit</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">s</span> <span class="n">value</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="bp">None</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">c</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="bp">None</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="s1">&#39;value-to-store&#39;</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">t</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="bp">None</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="bp">None</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="bp">None</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="bp">None</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span> <span class="n">one</span> <span class="o">-</span><span class="n">a</span> <span class="n">two</span> <span class="o">-</span><span class="n">a</span> <span class="n">three</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="bp">None</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="bp">None</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="s1">&#39;two&#39;</span><span class="p">,</span> <span class="s1">&#39;three&#39;</span><span class="p">]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">B</span> <span class="o">-</span><span class="n">A</span>

<span class="n">simple_value</span>     <span class="o">=</span> <span class="bp">None</span>
<span class="n">constant_value</span>   <span class="o">=</span> <span class="bp">None</span>
<span class="n">boolean_t</span>        <span class="o">=</span> <span class="bp">False</span>
<span class="n">boolean_f</span>        <span class="o">=</span> <span class="bp">True</span>
<span class="n">collection</span>       <span class="o">=</span> <span class="p">[]</span>
<span class="n">const_collection</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;value-2-to-append&#39;</span><span class="p">,</span> <span class="s1">&#39;value-1-to-append&#39;</span><span class="p">]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">version</span>

<span class="n">argparse_action</span><span class="o">.</span><span class="n">py</span> <span class="mf">1.0</span>
</pre></div>


<h2 id="_2">可选前缀</h2>
<p>ArgumentParser函数中的选项prefix_chars可以指定前缀。默认使用UNIX风格，命令行使用‘-’作为前缀。可以使用windows的’/’或者其他符号。</p>
<p>argparse_prefix_chars.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Change the option prefix characters&#39;</span><span class="p">,</span>
    <span class="n">prefix_chars</span><span class="o">=</span><span class="s1">&#39;-+/&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_false&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Turn A off&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;+a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Turn A on&#39;</span><span class="p">,</span>
                    <span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;//noarg&#39;</span><span class="p">,</span> <span class="s1">&#39;++noarg&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">+</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">//</span><span class="n">noarg</span><span class="p">]</span>

<span class="n">Change</span> <span class="n">the</span> <span class="n">option</span> <span class="n">prefix</span> <span class="n">characters</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>        <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span>                <span class="n">Turn</span> <span class="n">A</span> <span class="n">off</span>
  <span class="o">+</span><span class="n">a</span>                <span class="n">Turn</span> <span class="n">A</span> <span class="n">on</span>
  <span class="o">//</span><span class="n">noarg</span><span class="p">,</span> <span class="o">++</span><span class="n">noarg</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">+</span><span class="n">a</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">noarg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">noarg</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">//</span><span class="n">noarg</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">noarg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">++</span><span class="n">noarg</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">noarg</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">noarg</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">+</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">//</span><span class="n">noarg</span><span class="p">]</span>
<span class="n">argparse_prefix_chars</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">unrecognized</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">--</span><span class="n">noarg</span>
</pre></div>


<h2 id="_3">处理配置文件中的参数</h2>
<p>argparse_with_shlex.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">configparser</span> <span class="kn">import</span> <span class="n">ConfigParser</span>
<span class="kn">import</span> <span class="nn">shlex</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Short sample app&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="p">()</span>
<span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;argparse_with_shlex.ini&#39;</span><span class="p">)</span>
<span class="n">config_value</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;cli&#39;</span><span class="p">,</span> <span class="s1">&#39;options&#39;</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Config  :&#39;</span><span class="p">,</span> <span class="n">config_value</span><span class="p">)</span>

<span class="n">argument_list</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">config_value</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Arg List:&#39;</span><span class="p">,</span> <span class="n">argument_list</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;Results :&#39;</span><span class="p">,</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">argument_list</span><span class="p">))</span>
</pre></div>


<p>其中argparse_with_shlex.ini文件的内容如下：</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="n">cli</span><span class="p">]</span>
<span class="n">options</span> <span class="o">=</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span> <span class="mi">2</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_with_shlex</span><span class="o">.</span><span class="n">py</span>

<span class="n">Config</span>  <span class="p">:</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span> <span class="mi">2</span>
<span class="n">Arg</span> <span class="n">List</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">]</span>
<span class="n">Results</span> <span class="p">:</span> <span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>


<p>上面例子使用了ConfigParser来读取配置，再用shlex来切割参数。也可以通过fromfile_prefix_chars 告知argparse输入参数为文件。</p>
<p>argparse_fromfile_prefix_chars.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">shlex</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Short sample app&#39;</span><span class="p">,</span>
                                 <span class="n">fromfile_prefix_chars</span><span class="o">=</span><span class="s1">&#39;@&#39;</span><span class="p">,</span>
                                 <span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;@argparse_fromfile_prefix_chars.txt&#39;</span><span class="p">]))</span>
</pre></div>


<p>argparse_fromfile_prefix_chars.txt</p>
<div class="highlight"><pre><span></span><span class="o">-</span><span class="n">a</span>
<span class="o">-</span><span class="n">b</span>
<span class="mi">2</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_fromfile_prefix_chars</span><span class="o">.</span><span class="n">py</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>


<h2 id="_4">帮助</h2>
<ul>
<li>自动生成</li>
</ul>
<p>Argparse会自动生成的帮助和版本信息。ArgumentParser的add_help参数控制帮助的生成，默认是开启。</p>
<p>argparse_with_help.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>下例就关闭帮助：</p>
<p>argparse_without_help.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python</span> <span class="n">argparse_with_help</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_with_help</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">C</span><span class="p">]</span>
<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
<span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span> <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
<span class="o">-</span><span class="n">a</span>
<span class="o">-</span><span class="n">b</span> <span class="n">B</span>
<span class="o">-</span><span class="n">c</span> <span class="n">C</span>
<span class="err">$</span> <span class="n">python</span> <span class="n">argparse_without_help</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_without_help</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">C</span><span class="p">]</span>
<span class="n">argparse_without_help</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">unrecognized</span> <span class="n">arguments</span><span class="p">:</span> <span class="o">-</span><span class="n">h</span>
</pre></div>


<ul>
<li>自定义帮助</li>
</ul>
<p>argparse_custom_help.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;print_usage output:&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">print_usage</span><span class="p">()</span>
<span class="k">print</span><span class="p">()</span>

<span class="k">print</span><span class="p">(</span><span class="s1">&#39;print_help output:&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_custom_help</span><span class="o">.</span><span class="n">py</span>

<span class="n">print_usage</span> <span class="n">output</span><span class="p">:</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_custom_help</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">C</span><span class="p">]</span>

<span class="n">print_help</span> <span class="n">output</span><span class="p">:</span>
<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_custom_help</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">B</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">c</span> <span class="n">C</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span>
  <span class="o">-</span><span class="n">b</span> <span class="n">B</span>
  <span class="o">-</span><span class="n">c</span> <span class="n">C</span>
</pre></div>


<p>argparse_raw_description_help_formatter.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawDescriptionHelpFormatter</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    description</span>
<span class="s2">        not</span>
<span class="s2">           wrapped&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    epilog</span>
<span class="s2">      not</span>
<span class="s2">         wrapped&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;argument</span>
<span class="s2">    help is</span>
<span class="s2">    wrapped</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_raw_description_help_formatter</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_raw_description_help_formatter</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span>

    <span class="n">description</span>
        <span class="ow">not</span>
           <span class="n">wrapped</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span>          <span class="n">argument</span> <span class="n">help</span> <span class="ow">is</span> <span class="n">wrapped</span>

    <span class="n">epilog</span>
      <span class="ow">not</span>
         <span class="n">wrapped</span>
</pre></div>


<p>argparse_raw_text_help_formatter.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">RawTextHelpFormatter</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    description</span>
<span class="s2">        not</span>
<span class="s2">           wrapped&quot;&quot;&quot;</span><span class="p">,</span>
    <span class="n">epilog</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    epilog</span>
<span class="s2">      not</span>
<span class="s2">         wrapped&quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;argument</span>
<span class="s2">    help is not</span>
<span class="s2">    wrapped</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_raw_text_help_formatter</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_raw_text_help_formatter</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">]</span>

    <span class="n">description</span>
        <span class="ow">not</span>
           <span class="n">wrapped</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span>          <span class="n">argument</span>
                  <span class="n">help</span> <span class="ow">is</span> <span class="ow">not</span>
                  <span class="n">wrapped</span>


    <span class="n">epilog</span>
      <span class="ow">not</span>
         <span class="n">wrapped</span>
</pre></div>


<p>argparse_metavar_type_help_formatter.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">formatter_class</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">MetavarTypeHelpFormatter</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;notshown1&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;notshown2&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_metavar_type_help_formatter</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_metavar_type_help_formatter</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="nb">int</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span>
 <span class="nb">float</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">i</span> <span class="nb">int</span>
  <span class="o">-</span><span class="n">f</span> <span class="nb">float</span>
</pre></div>


<h2 id="_5">组织解析器</h2>
<p>公共解析器:通过父子类来实现。</p>
<p>见argparse_parent_base.py：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--user&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--password&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
</pre></div>


<p>argparse_uses_parent.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">argparse_parent_base</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">argparse_parent_base</span><span class="o">.</span><span class="n">parser</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--local-arg&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>注意：父类关闭了help。子类却默认开启了help。执行结果：</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_uses_parent</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_uses_parent</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">user</span> <span class="n">USER</span><span class="p">]</span>
                               <span class="p">[</span><span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span><span class="p">]</span>
                               <span class="p">[</span><span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">arg</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">user</span> <span class="n">USER</span>
  <span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span>
  <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">arg</span>
</pre></div>


<h2 id="_6">参数冲突</h2>
<p>argparse_conflict_handler_resolve.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">conflict_handler</span><span class="o">=</span><span class="s1">&#39;resolve&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Short alone&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--long-b&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Long and short together&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;-h&#39;</span><span class="p">]))</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_conflict_handler_resolve</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_conflict_handler_resolve</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">]</span>
<span class="p">[</span><span class="o">--</span><span class="nb">long</span><span class="o">-</span><span class="n">b</span> <span class="n">LONG_B</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span> <span class="n">A</span>
  <span class="o">--</span><span class="nb">long</span><span class="o">-</span><span class="n">b</span> <span class="n">LONG_B</span><span class="p">,</span> <span class="o">-</span><span class="n">b</span> <span class="n">LONG_B</span>
                        <span class="n">Long</span> <span class="ow">and</span> <span class="n">short</span> <span class="n">together</span>
</pre></div>


<p>argparse_conflict_handler_resolve2.py、</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">conflict_handler</span><span class="o">=</span><span class="s1">&#39;resolve&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--long-b&#39;</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Long and short together&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Short alone&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;-h&#39;</span><span class="p">]))</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_conflict_handler_resolve2</span><span class="o">.</span><span class="n">py</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_conflict_handler_resolve2</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="n">A</span><span class="p">]</span>
                                             <span class="p">[</span><span class="o">--</span><span class="nb">long</span><span class="o">-</span><span class="n">b</span> <span class="n">LONG_B</span><span class="p">]</span>
                                             <span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">B</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>       <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span> <span class="n">A</span>
  <span class="o">--</span><span class="nb">long</span><span class="o">-</span><span class="n">b</span> <span class="n">LONG_B</span>  <span class="n">Long</span> <span class="ow">and</span> <span class="n">short</span> <span class="n">together</span>
  <span class="o">-</span><span class="n">b</span> <span class="n">B</span>             <span class="n">Short</span> <span class="n">alone</span>
</pre></div>


<h2 id="_7">参数分组</h2>
<p>默认有可选参数和必选参数组。</p>
<p>argparse_default_grouping.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Short sample app&#39;</span><span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--optional&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;positional&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_default_grouping</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_default_grouping</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">optional</span><span class="p">]</span> <span class="n">positional</span>

<span class="n">Short</span> <span class="n">sample</span> <span class="n">app</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">positional</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">optional</span>
</pre></div>


<p>前面的用户名和密码就可以分组：</p>
<p>argparse_parent_with_group.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">add_help</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_argument_group</span><span class="p">(</span><span class="s1">&#39;authentication&#39;</span><span class="p">)</span>

<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--user&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--password&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store&quot;</span><span class="p">)</span>
</pre></div>


<p>argparse_uses_parent_with_group.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">argparse_parent_with_group</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span>
    <span class="n">parents</span><span class="o">=</span><span class="p">[</span><span class="n">argparse_parent_with_group</span><span class="o">.</span><span class="n">parser</span><span class="p">],</span>
<span class="p">)</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--local-arg&#39;</span><span class="p">,</span>
                    <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span>
                    <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_uses_parent_with_group</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_uses_parent_with_group</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">user</span> <span class="n">USER</span><span class="p">]</span>
                                          <span class="p">[</span><span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span><span class="p">]</span>
                                          <span class="p">[</span><span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">arg</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>           <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">arg</span>

<span class="n">authentication</span><span class="p">:</span>
  <span class="o">--</span><span class="n">user</span> <span class="n">USER</span>
  <span class="o">--</span><span class="n">password</span> <span class="n">PASSWORD</span>
</pre></div>


<h2 id="_8">互斥选项</h2>
<p>使用add_mutually_exclusive_group()可以添加互斥选项：</p>
<p>argparse_mutually_exclusive.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">group</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_mutually_exclusive_group</span><span class="p">()</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="o">|</span> <span class="o">-</span><span class="n">b</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>  <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">a</span>
  <span class="o">-</span><span class="n">b</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">b</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">b</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">a</span> <span class="o">|</span> <span class="o">-</span><span class="n">b</span><span class="p">]</span>
<span class="n">argparse_mutually_exclusive</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">b</span><span class="p">:</span> <span class="ow">not</span> <span class="n">allowed</span>
<span class="k">with</span> <span class="n">argument</span> <span class="o">-</span><span class="n">a</span>
</pre></div>


<h2 id="_9">嵌套解析</h2>
<p>argparse_subparsers.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">subparsers</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">add_subparsers</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s1">&#39;commands&#39;</span><span class="p">)</span>

<span class="c1"># A list command</span>
<span class="n">list_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
    <span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;List contents&#39;</span><span class="p">)</span>
<span class="n">list_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;dirname&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Directory to list&#39;</span><span class="p">)</span>

<span class="c1"># A create command</span>
<span class="n">create_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
    <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Create a directory&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;dirname&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;New directory to create&#39;</span><span class="p">)</span>
<span class="n">create_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;--read-only&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Set permissions to prevent writing to the directory&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># A delete command</span>
<span class="n">delete_parser</span> <span class="o">=</span> <span class="n">subparsers</span><span class="o">.</span><span class="n">add_parser</span><span class="p">(</span>
    <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Remove a directory&#39;</span><span class="p">)</span>
<span class="n">delete_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;dirname&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;The directory to remove&#39;</span><span class="p">)</span>
<span class="n">delete_parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;--recursive&#39;</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store_true&#39;</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Remove the contents of the directory, too&#39;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_subparsers</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_subparsers</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">{</span><span class="nb">list</span><span class="p">,</span><span class="n">create</span><span class="p">,</span><span class="n">delete</span><span class="p">}</span> <span class="o">...</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="p">{</span><span class="nb">list</span><span class="p">,</span><span class="n">create</span><span class="p">,</span><span class="n">delete</span><span class="p">}</span>  <span class="n">commands</span>
    <span class="nb">list</span>                <span class="n">List</span> <span class="n">contents</span>
    <span class="n">create</span>              <span class="n">Create</span> <span class="n">a</span> <span class="n">directory</span>
    <span class="n">delete</span>              <span class="n">Remove</span> <span class="n">a</span> <span class="n">directory</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_subparsers</span><span class="o">.</span><span class="n">py</span> <span class="n">create</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_subparsers</span><span class="o">.</span><span class="n">py</span> <span class="n">create</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">]</span> <span class="n">dirname</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">dirname</span>      <span class="n">New</span> <span class="n">directory</span> <span class="n">to</span> <span class="n">create</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>   <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">read</span><span class="o">-</span><span class="n">only</span>  <span class="n">Set</span> <span class="n">permissions</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">writing</span> <span class="n">to</span> <span class="n">the</span> <span class="n">directo</span>
<span class="n">ry</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_subparsers</span><span class="o">.</span><span class="n">py</span> <span class="n">delete</span> <span class="o">-</span><span class="n">r</span> <span class="n">foo</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<h2 id="_10">高级参数处理</h2>
<p>可变参数：数字N代表N的参数，？0或者1个参数。*0或者多个参数。+1或者多个参数。</p>
<p>argparse_nargs.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--three&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--optional&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--all&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--one-or-more&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">three</span> <span class="n">THREE</span> <span class="n">THREE</span> <span class="n">THREE</span><span class="p">]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">optional</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">]]</span>
                <span class="p">[</span><span class="o">--</span><span class="nb">all</span> <span class="p">[</span><span class="n">ALL</span> <span class="p">[</span><span class="n">ALL</span> <span class="o">...</span><span class="p">]]]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="n">ONE_OR_MORE</span> <span class="p">[</span><span class="n">ONE_OR_MORE</span> <span class="o">...</span><span class="p">]]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">three</span> <span class="n">THREE</span> <span class="n">THREE</span> <span class="n">THREE</span>
  <span class="o">--</span><span class="n">optional</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">]</span>
  <span class="o">--</span><span class="nb">all</span> <span class="p">[</span><span class="n">ALL</span> <span class="p">[</span><span class="n">ALL</span> <span class="o">...</span><span class="p">]]</span>
  <span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="n">ONE_OR_MORE</span> <span class="p">[</span><span class="n">ONE_OR_MORE</span> <span class="o">...</span><span class="p">]</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">three</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">three</span> <span class="n">THREE</span> <span class="n">THREE</span> <span class="n">THREE</span><span class="p">]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">optional</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">]]</span>
                <span class="p">[</span><span class="o">--</span><span class="nb">all</span> <span class="p">[</span><span class="n">ALL</span> <span class="p">[</span><span class="n">ALL</span> <span class="o">...</span><span class="p">]]]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="n">ONE_OR_MORE</span> <span class="p">[</span><span class="n">ONE_OR_MORE</span> <span class="o">...</span><span class="p">]]</span>
<span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">--</span><span class="n">three</span><span class="p">:</span> <span class="n">expected</span> <span class="mi">3</span>
<span class="n">argument</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">three</span> <span class="n">a</span> <span class="n">b</span> <span class="n">c</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="n">three</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">])</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">optional</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">optional</span> <span class="n">with_value</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="s1">&#39;with_value&#39;</span><span class="p">,</span>
<span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">all</span> <span class="k">with</span> <span class="n">multiple</span> <span class="n">values</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">one_or_more</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="n">with_value</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;with_value&#39;</span><span class="p">],</span> <span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
<span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="k">with</span> <span class="n">multiple</span> <span class="n">values</span>

<span class="n">Namespace</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">one_or_more</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="s1">&#39;multiple&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">],</span>
<span class="n">optional</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">three</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">three</span> <span class="n">THREE</span> <span class="n">THREE</span> <span class="n">THREE</span><span class="p">]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">optional</span> <span class="p">[</span><span class="n">OPTIONAL</span><span class="p">]]</span>
                <span class="p">[</span><span class="o">--</span><span class="nb">all</span> <span class="p">[</span><span class="n">ALL</span> <span class="p">[</span><span class="n">ALL</span> <span class="o">...</span><span class="p">]]]</span>
                <span class="p">[</span><span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span> <span class="n">ONE_OR_MORE</span> <span class="p">[</span><span class="n">ONE_OR_MORE</span> <span class="o">...</span><span class="p">]]</span>
<span class="n">argparse_nargs</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">--</span><span class="n">one</span><span class="o">-</span><span class="ow">or</span><span class="o">-</span><span class="n">more</span><span class="p">:</span> <span class="n">expected</span>
<span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">argument</span>
</pre></div>


<h2 id="_11">参数类型</h2>
<p>argparse_type.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--file&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">open</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>

<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="mi">1</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="mf">3.14</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="mf">3.14</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">file</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">file</span><span class="o">=&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span>
<span class="n">name</span><span class="o">=</span><span class="s1">&#39;argparse_type.py&#39;</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;r&#39;</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="n">a</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">F</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">file</span> <span class="n">FILE</span><span class="p">]</span>
<span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">i</span><span class="p">:</span> <span class="n">invalid</span> <span class="nb">int</span> <span class="n">value</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">f</span> <span class="mf">3.14</span><span class="o">.</span><span class="mi">15</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">F</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">file</span> <span class="n">FILE</span><span class="p">]</span>
<span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">f</span><span class="p">:</span> <span class="n">invalid</span> <span class="nb">float</span> <span class="n">value</span><span class="p">:</span>
<span class="s1">&#39;3.14.15&#39;</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="nb">file</span> <span class="n">does_not_exist</span><span class="o">.</span><span class="n">txt</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="n">I</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">f</span> <span class="n">F</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="nb">file</span> <span class="n">FILE</span><span class="p">]</span>
<span class="n">argparse_type</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">:</span>
<span class="s1">&#39;does_not_exist.txt&#39;</span>
</pre></div>


<p>Choices可以指定参数的选项：</p>
<p>argparse_choices.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
    <span class="s1">&#39;--mode&#39;</span><span class="p">,</span>
    <span class="n">choices</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;read-only&#39;</span><span class="p">,</span> <span class="s1">&#39;read-write&#39;</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">())</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">mode</span> <span class="p">{</span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">,</span><span class="n">read</span><span class="o">-</span><span class="n">write</span><span class="p">}]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">--</span><span class="n">mode</span> <span class="p">{</span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">,</span><span class="n">read</span><span class="o">-</span><span class="n">write</span><span class="p">}</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">mode</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;read-only&#39;</span><span class="p">)</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">mode</span> <span class="n">invalid</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">--</span><span class="n">mode</span> <span class="p">{</span><span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="p">,</span><span class="n">read</span><span class="o">-</span><span class="n">write</span><span class="p">}]</span>
<span class="n">argparse_choices</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">--</span><span class="n">mode</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">choice</span><span class="p">:</span>
<span class="s1">&#39;invalid&#39;</span> <span class="p">(</span><span class="n">choose</span> <span class="kn">from</span> <span class="s1">&#39;read-only&#39;</span><span class="p">,</span> <span class="s1">&#39;read-write&#39;</span><span class="p">)</span>
</pre></div>


<h2 id="_12">文件参数</h2>
<p>argparse_FileType.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-i&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;in-file&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">FileType</span><span class="p">(</span><span class="s1">&#39;rt&#39;</span><span class="p">))</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-o&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;out-file&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">FileType</span><span class="p">(</span><span class="s1">&#39;wt&#39;</span><span class="p">))</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Input file:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Output file:&#39;</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">o</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">IOError</span> <span class="k">as</span> <span class="n">msg</span><span class="p">:</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">h</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="ow">in</span><span class="o">-</span><span class="nb">file</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">out</span><span class="o">-</span><span class="nb">file</span><span class="p">]</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>   <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="nb">exit</span>
  <span class="o">-</span><span class="n">i</span> <span class="ow">in</span><span class="o">-</span><span class="nb">file</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">out</span><span class="o">-</span><span class="nb">file</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">o</span> <span class="n">tmp_</span>\
<span class="nb">file</span><span class="o">.</span><span class="n">txt</span>

<span class="n">Input</span> <span class="nb">file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;argparse_FileType.py&#39;</span>
<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;rt&#39;</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="o">&gt;</span>
<span class="n">Output</span> <span class="nb">file</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">_io</span><span class="o">.</span><span class="n">TextIOWrapper</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;tmp_file.txt&#39;</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wt&#39;</span>
<span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="o">&gt;</span>

<span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">i</span> <span class="n">no_such_file</span><span class="o">.</span><span class="n">txt</span>

<span class="n">usage</span><span class="p">:</span> <span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="ow">in</span><span class="o">-</span><span class="nb">file</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">o</span> <span class="n">out</span><span class="o">-</span><span class="nb">file</span><span class="p">]</span>
<span class="n">argparse_FileType</span><span class="o">.</span><span class="n">py</span><span class="p">:</span> <span class="n">error</span><span class="p">:</span> <span class="n">argument</span> <span class="o">-</span><span class="n">i</span><span class="p">:</span> <span class="n">can</span><span class="s1">&#39;t open</span>
<span class="s1">&#39;no_such_file.txt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Errno</span> <span class="mi">2</span><span class="p">]</span> <span class="n">No</span> <span class="n">such</span> <span class="nb">file</span> <span class="ow">or</span> <span class="n">directory</span><span class="p">:</span>
<span class="s1">&#39;no_such_file.txt&#39;</span>
</pre></div>


<h2 id="action">自定义action</h2>
<p>自定义action是argparse.Action的子类可以处理add_argument中的参数定义相关的参数，并返回一个可调用对象。构造函数会处理参数定义，仅仅需要处理__call__函数。__call__函数中parser代表解释器，namespace用于返回解释结果，value为要处理的参数，option_string用于触发action（对可选参数，永远是None。</p>
<p>argparse_custom_action.py</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">argparse</span>


<span class="k">class</span> <span class="nc">CustomAction</span><span class="p">(</span><span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">option_strings</span><span class="p">,</span>
                 <span class="n">dest</span><span class="p">,</span>
                 <span class="n">nargs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">const</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">choices</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">required</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">help</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">metavar</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">argparse</span><span class="o">.</span><span class="n">Action</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                 <span class="n">option_strings</span><span class="o">=</span><span class="n">option_strings</span><span class="p">,</span>
                                 <span class="n">dest</span><span class="o">=</span><span class="n">dest</span><span class="p">,</span>
                                 <span class="n">nargs</span><span class="o">=</span><span class="n">nargs</span><span class="p">,</span>
                                 <span class="n">const</span><span class="o">=</span><span class="n">const</span><span class="p">,</span>
                                 <span class="n">default</span><span class="o">=</span><span class="n">default</span><span class="p">,</span>
                                 <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span>
                                 <span class="n">choices</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span>
                                 <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
                                 <span class="n">help</span><span class="o">=</span><span class="n">help</span><span class="p">,</span>
                                 <span class="n">metavar</span><span class="o">=</span><span class="n">metavar</span><span class="p">,</span>
                                 <span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Initializing CustomAction&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">locals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;self&#39;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">print</span><span class="p">(</span><span class="s1">&#39;  {} = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">print</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span>
                 <span class="n">option_string</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;Processing CustomAction for {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;  parser = {}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">parser</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;  values = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">&#39;  option_string = {!r}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">option_string</span><span class="p">))</span>

        <span class="c1"># Do some arbitrary processing of the input values</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="c1"># Save the results in the namespace using the destination</span>
        <span class="c1"># variable given to our constructor.</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">print</span><span class="p">()</span>


<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>

<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">CustomAction</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">CustomAction</span><span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">([</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;-m&#39;</span><span class="p">,</span> <span class="s1">&#39;multivalue&#39;</span><span class="p">,</span>
                             <span class="s1">&#39;second&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>


<p>执行结果</p>
<div class="highlight"><pre><span></span><span class="err">$</span> <span class="n">python3</span> <span class="n">argparse_custom_action</span><span class="o">.</span><span class="n">py</span>

<span class="n">Initializing</span> <span class="n">CustomAction</span>
  <span class="n">dest</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span>
  <span class="n">option_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-a&#39;</span><span class="p">]</span>
  <span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">Initializing</span> <span class="n">CustomAction</span>
  <span class="n">dest</span> <span class="o">=</span> <span class="s1">&#39;m&#39;</span>
  <span class="n">nargs</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span>
  <span class="n">option_strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-m&#39;</span><span class="p">]</span>
  <span class="n">required</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">Processing</span> <span class="n">CustomAction</span> <span class="k">for</span> <span class="n">a</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="mi">4315836992</span>
  <span class="n">values</span> <span class="o">=</span> <span class="s1">&#39;value&#39;</span>
  <span class="n">option_string</span> <span class="o">=</span> <span class="s1">&#39;-a&#39;</span>

<span class="n">Processing</span> <span class="n">CustomAction</span> <span class="k">for</span> <span class="n">m</span>
  <span class="n">parser</span> <span class="o">=</span> <span class="mi">4315836992</span>
  <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;multivalue&#39;</span><span class="p">,</span> <span class="s1">&#39;second&#39;</span><span class="p">]</span>
  <span class="n">option_string</span> <span class="o">=</span> <span class="s1">&#39;-m&#39;</span>

<span class="n">Namespace</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;VALUE&#39;</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;MULTIVALUE&#39;</span><span class="p">,</span> <span class="s1">&#39;SECOND&#39;</span><span class="p">])</span>
</pre></div>


<h2 id="_13">参考资料</h2>
<ul>
<li><a href="https://github.com/china-testing/python-api-tesing/blob/master/books.md">本文相关书籍下载</a></li>
<li>python测试等IT技术支持qq群144081101(后期会录制视频存在该群群文件) 591302926 567351477 </li>
<li>道家技术-手相手诊看相中医等钉钉群21734177 qq群：391441566 184175668 338228106 看手相、面相、舌相、抽签、体质识别。服务费50元每人次起。请联系钉钉或者微信pythontesting</li>
<li><a href="https://china-testing.github.io/python3_lib_argparse.html">本文最新版本地址</a></li>
<li><a href="https://github.com/china-testing/python-api-tesing">本文涉及的python测试开发库</a> 谢谢点赞！</li>
<li><a href="https://china-testing.github.io/testing_training.html">接口自动化性能测试线上培训大纲</a></li>
<li><a href="https://pymotw.com/3/argparse/index.html">英文参考</a></li>
</ul>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="https://china-testing.github.io/testing_training.html">自动化性能接口测试线上及深圳培训与项目实战 qq群：144081101 591302926</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">pandas数据分析scrapy爬虫 521070358 Py人工智能pandas-opencv 6089740</a></li>
                            <li><a href="http://blog.sciencenet.cn/blog-2604609-1112306.html">中医解梦看相八字算命qq群 391441566 csdn书籍下载-python爬虫 437355848</a></li>
                        </ul>
                </div><!-- /.blogroll -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>